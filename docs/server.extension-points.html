<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Invest Server Extension Points · Invest</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The Invest server offers several extension points for plugins, which are defined through Java interfaces. A plugin implementation needs to inherit one of those interfaces. "/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Invest Server Extension Points · Invest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://commitd.github.com/invest/investindex.html"/><meta property="og:description" content="The Invest server offers several extension points for plugins, which are defined through Java interfaces. A plugin implementation needs to inherit one of those interfaces. "/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/investundefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/investcss/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/invest"><h2 class="headerTitle">Invest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/investdocs/about.html" target="_self">About</a></li><li class=""><a href="/investdocs/dev.reading-list.html" target="_self">Development</a></li><li class=""><a href="/investdocs/ui.index.html" target="_self">UI</a></li><li class="siteNavGroupActive"><a href="/investdocs/server.index.html" target="_self">Server</a></li><li class=""><a href="https://github.com/commitd/invest-server" target="_self">Server Source</a></li><li class=""><a href="https://github.com/commitd/invest-ui" target="_self">UI Source</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Concepts</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/investdocs/server.index.html">Invest Server</a></li><li class="navListItem"><a class="navItem" href="/investdocs/server.faq.html">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Concepts</h3><ul><li class="navListItem"><a class="navItem" href="/investdocs/server.modules.html">Invest Server Modules</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/investdocs/server.extension-points.html">Invest Server Extension Points</a></li><li class="navListItem"><a class="navItem" href="/investdocs/server.data.html">Data</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Developing extensions</h3><ul><li class="navListItem"><a class="navItem" href="/investdocs/server.dev-maven.html">Developing extension with Maven</a></li><li class="navListItem"><a class="navItem" href="/investdocs/server.dev-data-extension.html">Developing Data extension</a></li><li class="navListItem"><a class="navItem" href="/investdocs/server.dev-service-extension.html">Developing Service extensions</a></li><li class="navListItem"><a class="navItem" href="/investdocs/server.dev-graphql-extension.html">Developing GraphQL extension</a></li><li class="navListItem"><a class="navItem" href="/investdocs/server.dev-api-extension.html">Developing API extension</a></li><li class="navListItem"><a class="navItem" href="/investdocs/server.dev-ui-extension.html">Developing UI extensions with Java</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Invest Server Extension Points</h1></header><article><div><span><p>The Invest server offers several extension points for plugins, which are defined through Java interfaces. A plugin implementation needs to inherit one of those interfaces.</p>
<p>The parent, and most generic, extension interface is <code>InvestExtension</code>. From this, you have several specialised classes:</p>
<ul>
<li><code>InvestUiExtension</code> hosts a UI plugin which will be available through the web browser</li>
<li><code>InvestGraphQlExtension</code> provides a GraphQL query or mutation endpoint</li>
<li><code>InvestApiExtension</code> provides a generic API endpoint (for example, providing an REST endpoint)</li>
<li><code>InvestDataExtension</code> provides data to the system (for example, connecting to a specific database to get specific data out)</li>
<li><code>InvestServiceExtension</code> provides a back end service (for example, provides an algorithm which another API or GraphQL extension might utilises)</li>
</ul>
<p>These specialisations may not contain more methods than the <code>InvestExtension</code> however it is important to extend the correct class as the different types are used by Invest server to wire the application and plugins together.</p>
<p>Spring does not know where to look for plugins. One way to find extensions would be through classpath scanning, but this is time consuming as the number of dependencies grow. Instead we use Spring autoconfiguration mechanism, much like Spring's starter kits too.</p>
<h2><a class="anchor" aria-hidden="true" id="implementing-a-plugin"></a><a href="#implementing-a-plugin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementing a plugin</h2>
<p>In order to implement a plugin you should create a class which implements one of the above.</p>
<p>The interfaces have default implementation for many of their methods, leaving the developer able to postpone some aspects of customisation until later if they follow the conventions. We recommend that plugin developers override methods which provide support to the user (eg the description of what the plugin does).</p>
<p>The plugin class implementation should be annotated with @Configuration, as it is a configuration bean via auto configuration.</p>
<pre><code class="hljs css languages- java"><span class="hljs-keyword">package</span> com.example.myplugin;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvestServiceExtension</span> </span>{

}
</code></pre>
<p>In order to make use of auto configuration Spring needs to know where to look for this bean. It does this via the <code>spring.factories</code> resource. Create the text file <code>src/main/resources/META-INF/spring.factories</code> which contains the following:</p>
<pre><code class="hljs css languages- ini">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.example.myplugin.MyPlugin
</code></pre>
<p>If you have multiple plugins, one UI and one GraphQL) in the same JAR they can be included in as follows:</p>
<pre><code class="hljs css languages- ini">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.myplugin.MyPlugin,\
com.example.another.MyOtherPlugin
</code></pre>
<p>Including this project in your classpath should now enable the plugin.</p>
<h2><a class="anchor" aria-hidden="true" id="typical-plugin-implementation"></a><a href="#typical-plugin-implementation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Typical plugin implementation</h2>
<p>Whilst the above produces a plugin, it does very little. The way to implement functionality in a plugin is dependent on the type of extension, but we just note a few simple examples here.</p>
<p>If your plugin is very simple (which is good), then you can expose a Spring bean directly</p>
<pre><code class="hljs css languages- java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvestServiceExtension</span> </span>{

    ...

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> MyPluginService <span class="hljs-title">myPluginService</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPluginService();
    }
}

</code></pre>
<p>If you have multiple components you need to hook up, or you want some more complex profile/configuration decisions, you could put them in their own configuration class and <code>@Import</code> it:</p>
<pre><code class="hljs css languages- java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Import</span>(MyPluginConfig.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvestServiceExtension</span> </span>{

    ...

}

<span class="hljs-meta">@Configuration</span>
<span class="hljs-comment">// Eg: @Profile('myplugin-enabled)</span>
<span class="hljs-comment">// Eg: @ConditionalOnClass(MongoDatabaseService.class)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> class <span class="hljs-title">MyPluginConfig</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> MyPluginService <span class="hljs-title">myPluginService</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyPluginService();
    }
}
</code></pre>
<p>Or, more likely, you can also use <code>@ComponentScan</code> in order to pull in services:</p>
<pre><code class="hljs css languages- java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-comment">// Use ourselves as the base package...</span>
<span class="hljs-meta">@ComponentScan</span>(MyPlugin.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvestServiceExtension</span> </span>{

    ...

}
</code></pre>
<p>Finally you probably want to offer settings (ConfigurationPropertoes) which a user can set via the YAML or properties files, and the plugin will pick up:</p>
<pre><code class="hljs css languages- java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableConfigurationProperties</span>(MyPluginSettings.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvestServiceExtension</span> </span>{

    ...

}

<span class="hljs-comment">// You don't need to use Lombok but...</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ConfigurationProperties</span>(<span class="hljs-string">"myplugin.settings"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPluginSettings</span> </span>{


    <span class="hljs-comment">// You can set this in your application.properties using 'myplugins.settings.title=Hello World'</span>
    <span class="hljs-keyword">private</span> String title;
}

</code></pre>
<h2><a class="anchor" aria-hidden="true" id="points-to-note"></a><a href="#points-to-note" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Points to note</h2>
<ul>
<li>You can have as many plugins in a single JAR as you like.</li>
<li>You can have plugins within say the <code>invest-server-app.jar</code> (if you want to create a single JAR file)</li>
<li>There is no isolation between extensions, thus any extension can <code>@Autowired</code> any other extension. In future this might change, for example such that Service Extensions can access Data Extensions but not Api Extensions, however this feels like an unnecessary constraint.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/investdocs/server.modules.html">← Invest Server Modules</a><a class="docs-next button" href="/investdocs/server.data.html">Data →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Sitemap</h5><a href="/investdocs/about.html">About</a><a href="/investdocs/server.index.html">Server</a><a href="/investdocs/ui.index.html">UI</a></div><div><h5>Resources</h5><a href="https://github.com/commitd/invest">Source</a></div></section><section class="copyright">Copyright © 2018 Committed</section></footer></div></body></html>