<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>System design: Outer frame · Invest</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This section discusses the application and Outer Frame loading process."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="System design: Outer frame · Invest"/><meta property="og:type" content="website"/><meta property="og:url" content="https://commitd.github.com/invest/investindex.html"/><meta property="og:description" content="This section discusses the application and Outer Frame loading process."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/investundefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/investcss/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/invest"><h2 class="headerTitle">Invest</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/investdocs/about.html" target="_self">About</a></li><li class=""><a href="/investdocs/dev.reading-list.html" target="_self">Development</a></li><li class="siteNavGroupActive"><a href="/investdocs/ui.index.html" target="_self">UI</a></li><li class=""><a href="/investdocs/server.index.html" target="_self">Server</a></li><li class=""><a href="https://github.com/commitd/invest-server" target="_self">Server Source</a></li><li class=""><a href="https://github.com/commitd/invest-ui" target="_self">UI Source</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Design</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/investdocs/ui.index.html">Invest UI</a></li><li class="navListItem"><a class="navItem" href="/investdocs/ui.faq.html">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Concepts</h3><ul><li class="navListItem"><a class="navItem" href="/investdocs/ui.ux.html">User interface and experience</a></li><li class="navListItem"><a class="navItem" href="/investdocs/ui.technologies.html">Invest UI Technologies</a></li><li class="navListItem"><a class="navItem" href="/investdocs/ui.modules.html">Invest UI Modules</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Design</h3><ul><li class="navListItem"><a class="navItem" href="/investdocs/ui.system-comms.html">System design: Communications</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/investdocs/ui.system-outer.html">System design: Outer frame</a></li><li class="navListItem"><a class="navItem" href="/investdocs/ui.system-plugin.html">System design: Plugin frame</a></li><li class="navListItem"><a class="navItem" href="/investdocs/ui.system-url.html">System design: URL</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Developing UIs</h3><ul><li class="navListItem"><a class="navItem" href="/investdocs/ui.dev-ui-extension.html">Developing UI modules</a></li><li class="navListItem"><a class="navItem" href="/investdocs/ui.dev-app-module.html">Advanced: Developing a new main application frontend</a></li><li class="navListItem"><a class="navItem" href="/investdocs/ui.dev-core-module.html">Advanced: Developing a core module</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Support</h3><ul><li class="navListItem"><a class="navItem" href="/investdocs/ui.live-development-plugin.html">Live development plugin</a></li><li class="navListItem"><a class="navItem" href="/investdocs/ui.action-development-plugin.html">Action development plugin</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">System design: Outer frame</h1></header><article><div><span><p>This section discusses the application and Outer Frame loading process.</p>
<h2><a class="anchor" aria-hidden="true" id="loading-and-bootstrapping-the-application"></a><a href="#loading-and-bootstrapping-the-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Loading and bootstrapping the application</h2>
<p>The application, and specifically the Outer Frame, is served by the Invest Server (a HTTP web server). The Invest Server is configured to serve the outer frame application from the root (<a href="http://server/">http://server/</a>) context.</p>
<p>On load, the Outer Frame application has no data itself. Therefore its initial task is to download some configuration information from the server via the API. This initial request includes settings, a list of plugins, etc. The application settings provide branding information (e.g. the application name to display).</p>
<p>All access is performed by the GraphQL endpoint on the server. Each component in the application makes GraphQL requests the for information they need (or indeed for information they believe that other plugins, etc will need).</p>
<p><img src="/investdocs/assets/images/ui-sysdesign-outerframe-bootstrap.png" alt="Outer Frame bootstrap process"></p>
<p>GraphQL requests are made using the React Apollo GraphQL framework. When the response is returned, the data is pushed into the Redux store via a Redux action. We adopt this approach so that certain information always available, without needing to make repeated requests to the server. As each GraphQL request is a HTTP request, there is HTTP middleware (link in Apollo) which is used to add session information (for authentication purposes).</p>
<p>When the data responses are returned, the application can be displayed. The application renders a list of available plugins and authentication options. If the URL states that a plugin should be displayed the application will load and display that plugin. This allows the use of bookmarks or shared links to specific application pages.</p>
<h2><a class="anchor" aria-hidden="true" id="hosting-the-plugins"></a><a href="#hosting-the-plugins" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hosting the plugins</h2>
<p>When the user clicks on a plugin (either from the outer frame or by clicking a link in another plugins), the URL is updated to reflect which plugin is in view.</p>
<p>The outer frame opens each plugin within its own <code>iframe</code>, where the <code>src</code> attribute is set to the plugins HTML link (on the Invest Server). These <code>iframe</code>s are not reused between plugins to avoid any accidental disclosure of information between plugins. Each <code>iframe</code> is run in sandbox mode, and this is quite restrictive on the operations the <code>iframe</code> can perform:</p>
<ul>
<li>treat the content as being from a unique origin (this means that the plugin can't access the outer frame and can't access the server)</li>
<li>disable browser APIs</li>
<li>prevent potentially malicious content</li>
<li>prevent the content to navigate its top-level browsing context</li>
<li>block automatically triggered features (such as automatically playing a video or automatically focusing a form control)</li>
</ul>
<p>In fact only the following is permitted:</p>
<ul>
<li>Allow Javascript execution as this is fundamental to most plugins.</li>
<li>Allow form submission in order to allow the plugin developer to present forms to the user.</li>
<li>Displaying alert notification, as although these is not a user friendly way to display information or a warning, it is simple for the developer and is a sensible way of telling the user that the operation they are about to perform may have dangerous side effects.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="communication-between-the-outer-frame-and-a-plugin"></a><a href="#communication-between-the-outer-frame-and-a-plugin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Communication between the Outer Frame and a plugin</h2>
<p>Once the <code>iframe</code> has loaded, the Outer Frame creates a two-way connection between it and the plugin frame.</p>
<p><img src="/investdocs/assets/images/ui-sysdesign-outerframe-notify.png" alt="Outer Frame notifications"></p>
<p>Once the communication layer is established, the Outer Frame sends a series of messages to the plugin frame. These include a 'loaded' message, a 'shown' message and then if an intent has been provided it is sent to the plugin as an 'action' message.</p>
<h2><a class="anchor" aria-hidden="true" id="responding-to-the-plugin-requests"></a><a href="#responding-to-the-plugin-requests" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Responding to the plugin requests</h2>
<p>As noted in previous sections the plugin can make requests of the Outer Frame. This is necessary to the function of the plugins - due to the sandboxing of the plugin it can not make requests to the server itself.</p>
<p>When a plugins wishes to make an API request to the server, it is actioned by a Handler. The handler is responsible for the execution of requests and the return of a response. The handler sits inside the Outer Frame.</p>
<p>There are three ways the handler may action a request:</p>
<ul>
<li>If the request is a GraphQL operation then it is passed to the Outer Frame's GraphQL service. This service is, in effect, a proxy to the Invest Server's GraphQL endpoint, but which is enhanced with a number of additional operations which the Outer Frame can action directly. For example, getting a list of plugins. Having a local GraphQL service does add complexity but it reduces the need for a server round trip and it allows for specialised, state aware responses. For example, the Outer Frame will only list the UI Plugins for which the user has access.</li>
<li>We provide a <code>fetch</code> operation as part of the plugin API. This replaces the native <code>fetch</code> which is available in the browser. The reason for this replacement is due to the effect of sandboxing and also because we wish to add authentication information to each HTTP request (when it is directed to the Invest Server).</li>
<li>Some requests are wholly for the Outer Frame, for example navigation. Within the Outer Frame we map requests to Redux Actions. For each request, an actions is dispatched to the Redux store, which is  picked up by a Redux Saga to be actioned. The Saga has full access to the application state.</li>
</ul>
<p><img src="/investdocs/assets/images/ui-sysdesign-outerframe-request.png" alt="Outer Frame request"></p>
<h2><a class="anchor" aria-hidden="true" id="navigating-away-from-a-plugin"></a><a href="#navigating-away-from-a-plugin" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Navigating away from a plugin</h2>
<p>When the user navigates away from the displayed plugin the <code>iframe</code> showing that plugin is hidden and a new iframe is created (or old version made visible) for the new plugin. At the same time a message is sent to the old plugin notifying it that it is to be hidden. In this manner the plugin can stop any animations, data requests, processing, etc which might affect performance of whatever is in view.</p>
<p>The nice side effect of the hidden iframe model is that the exact state of plugin is retained, and thus restored when the users navigates back to it.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/investdocs/ui.system-comms.html">← System design: Communications</a><a class="docs-next button" href="/investdocs/ui.system-plugin.html">System design: Plugin frame →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Sitemap</h5><a href="/investdocs/about.html">About</a><a href="/investdocs/server.index.html">Server</a><a href="/investdocs/ui.index.html">UI</a></div><div><h5>Resources</h5><a href="https://github.com/commitd/invest">Source</a></div></section><section class="copyright">Copyright © 2018 Committed</section></footer></div></body></html>